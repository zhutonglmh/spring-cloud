TCP  UDP 的区别

* TCP 是面向连接的，UDP 是面向无连接的
* UDP程序结构较简单
* TCP 是面向字节流的，UDP 是基于数据报的
* TCP 保证数据正确性，UDP 可能丢包
* TCP 保证数据顺序，UDP 不保证


1、UDP

要想理解 TCP 和 UDP 的区别，首先要明白什么是TCP，什么是UDP
TCP 和 UDP 是传输层的两个协议

UDP 的包头

    -----------------------------------------------------------------------------------
    |             源端口号(16位)           |             目的端口号                   |
    |--------------------------------------|------------------------------------------|
    |             UDP长度(16位)            |              UDP校验和(16位)             |
    |---------------------------------------------------------------------------------| 
    |                                                                                 |
    |                                     数据                                        |
    |                                                                                 |
    |---------------------------------------------------------------------------------|
由上图可以看出，UDP除了端口号，基本就啥都没有了，如果没有这两个端口号，数据就不知道发给哪个应用。
所以UDP就像一个小孩子，特别简单，有如下三个特点

2、UDP的特点

   * 沟通简单，不需要大量的数据结构，处理逻辑和包头子弹
   * 轻信他人，它不会建立连接，但是会监听这个地方，谁都可以给它传数据，它也可以传给任何人数据，甚至可以同时传给多个人数据。
   * 愣头青，做事不懂变通。不会根据网络的情况进行拥塞控制，无论是否丢包，它该怎么发还怎么发
   
   
3、UDP的主要应用场景

   * 需要资源少，网络情况稳定的内网，或者对于丢包不敏感的应用，比如DHCP 就是基于UDP协议的
   * 不需要一对一沟通，简历连接，而是可以广播的应用，因为它不面向连接，所以可以做到一对多，承担广播或者多播的协议
   * 需要处理速度快，可以容忍丢包，但是即使网络拥塞，也毫不退缩，一往无前的时候
   
4、基于UDP的几个例子
  
   * 直播。直播对于实时性的要求比较高，宁可丢包，也不要卡顿的，所以很多直播应用都基于UDP 实现了自己的视频传输协议
   * 实时游戏。游戏的特点也是要求实时性比较高，采用自定义的可靠的UDP协议，自定义重传策略，能够把产生的延迟降到最低，减少网络问题对于游戏的影响
   * 物联网，一方面，物联网领域中 中断资源少，很可能只是个很小的嵌入式系统，而维护TCP协议的代价太大了；另一方面，物联网对实时性的要求也比较高。比如
     google旗下的nest thread group，推出了物联网通信协议Thread，就是基于UDP协议的
    
  
   
     
1、TCP

首先是TCP的包头格式

        ----------------------------------------------------------------------------------------------------
        +               源端口号(16位)                    +                 目标端口号(16位)               +
        ----------------------------------------------------------------------------------------------------
        +                                             序号(32位)                                           +
        ----------------------------------------------------------------------------------------------------
        +                                            确认序号(32位)                                        +
        ----------------------------------------------------------------------------------------------------
        +           +             + U + A + P + R + S + F  +                                               +
        +  首部长度 +  保留(6位)  + R + C + S + S + Y + I  +                窗口大小(16位)                 +
        +           +             + G + K + H + T + N + N  +                                               +
        ----------------------------------------------------------------------------------------------------
        +                     校验和(16位)                 +                    紧急指针(16位              +
        ----------------------------------------------------------------------------------------------------
        +                                                 选项                                             +
        ----------------------------------------------------------------------------------------------------
        +                                                                                                  +
        +                                                                                                  +
        +                                                 数据                                             +
        +                                                                                                  +
        +                                                                                                  +
        ----------------------------------------------------------------------------------------------------
2、TCP 的包头有哪些内容，分别有什么用？
 
     * 首先，源端口和目标端口是不可少的。
     * 接下来是包的序号。主要是为了解决乱序问题。
     * 确认序号，发出去的包应该有确认，这样能知道对方是否收到，如果没收到就应该重新发送，这个解决的是不丢包的问题
     * 状态位。SYN是发起一个链接，ACK是回复，RST是重新链接，FIN 是结束连接。因为TCP是面向连接的，因此需要双方维护连接的状态
            ，这些状态位的包会引起双方的状态变更
     * 窗口大小，TCP要做流量控制，需要通信双方各声明一个窗口，标识自己当前的处理能力。 
  
3、通过对TCP头的解析，我们知道要掌握TCP协议，应该重点关注以下问题：
        
        1、顺序问题
        2、丢包问题
        3、连接维护
        4、流量控制
        5、拥塞控制
             
4、TCP的三次握手   

    A：您好，我是 A
    B：您好 A，我是 B
    A：您好 B
      
5、TCP 四次挥手

    A：B 啊，我不想玩了
    B：哦，你不想玩了啊，我知道了
    这个时候，只是 A 不想玩了，即不再发送数据，但是 B 可能还有未发送完的数据，所以需要等待 B 也主动关闭。
    B：A 啊，好吧，我也不玩了，拜拜
    A：好的，拜拜     (此时B收到后关闭)(此时A等待2msl(分钟)后A关闭)
    
6、累计确认(TCP如何实现可靠传输？)

    首先为了保证顺序性，每个包都有一个 ID。在建立连接的时候会商定起始 
    ID 是什么，然后按照 ID 一个个发送，为了保证不丢包，需要对发送的包都要进行应答，当然，这个应答不是一个一个来的，
    而是会应答某个之前的 ID，表示都收到了，这种模式成为累计应答或累计确认。
    
    
    为了记录所有发送的包和接收的包，TCP 需要发送端和接收端分别来缓存这些记录，发送端的缓存里是按照包的 ID 一个个排列，根据处理的情况分成四个部分
        
        发送并且确认的
        发送尚未确认的
        没有发送等待发送的
        没有发送并且暂时不会发送的
    
    
    对于接收端来讲，它的缓存里面的内容要简单一些
    
        接收并且确认过的
        还没接收，但是马上就能接收的
        还没接收，但也无法接收的
    
7、顺序问题和丢包问题

    顺序问题和丢包问题都有可能存在，所以我们先来看确认与重传机制。
    
    假设 4 的确认收到了，5 的 ACK 丢了，6、7 的数据包丢了，该怎么办？
    
    一种方法是超时重试，即对每一个发送了但是没有 ACK 的包设定一个定时器，超过了一定的事件就重新尝试。这个时间必须大于往返时间，
    但也不宜过长，否则超时时间变长，访问就变慢了。
    
    如果过一段时间，5、6、7 都超时了就会重新发送。接收方发现 5 原来接收过，于是丢弃 5；6 收到了，发送 ACK，要求下一个是 7，7 不幸又丢了。当 7 再次超时的时候，TCP 的策略是超时间隔加倍。
    每当遇到一次超时重传的时候，都会讲下一次超时时间间隔设为先前值的两倍。
    
    超时重传的机制是超时周期可能相对较长，是否有更快的方式呢？
    
    有一个快速重传的机制，即当接收方接收到一个序号大于期望的报文段时，就检测到了数据流之间的间隔，于是发送三个冗余的 ACK，客户端接收到之后，
    知道数据报丢失，于是重传丢失的报文段。
    
    例如，接收方发现 6、8、9 都接收了，但是 7 没来，所以肯定丢了，于是发送三个 6 的 ACK，要求下一个是 7。客户端接收到 3 个，就会发现 7 的确又丢了，不等超时，马上重发。

8、流量控制的问题
    
    在流量控制的机制里面，在对于包的确认中，会携带一个窗口的大小
    
    简单的说一下就是接收端在发送 ACK 的时候会带上缓冲区的窗口大小，但是一般在窗口达到一定大小才会更新窗口，因为每次都更新的话，刚空下来就又被填满了
    
9、拥塞控制的问题

    TCP 拥塞控制主要来避免两种现象，包丢失和超时重传，一旦出现了这些现象说明发送的太快了，要慢一点。
    
    具体的方法就是发送端慢启动，比如倒水，刚开始倒的很慢，渐渐变快。然后设置一个阈值，当超过这个值的时候就要慢下来
    
    慢下来还是在增长，这时候就可能水满则溢，出现拥塞，需要降低倒水的速度，等水慢慢渗下去。
    
    拥塞的一种表现是丢包，需要超时重传，这个时候，采用快速重传算法，将当前速度变为一半。所以速度还是在比较高的值，也没有一夜回到解放前。

 面试问题
 
 1、TCP 和 UDP 的区别
 
    TCP 是面向连接的，UDP 是面向无连接的
    UDP程序结构较简单
    TCP 是面向字节流的，UDP 是基于数据报的
    TCP 保证数据正确性，UDP 可能丢包
    TCP 保证数据顺序，UDP 不保证
    
 2、什么是面向连接，什么是面向无连接
 
    在互通之前，面向连接的协议会先建立连接，如 TCP 有三次握手，而 UDP 不会
    
 3、TCP 为什么是可靠连接
 
    通过 TCP 连接传输的数据无差错，不丢失，不重复，且按顺序到达。
    TCP 报文头里面的序号能使 TCP 的数据按序到达
    报文头里面的确认序号能保证不丢包，累计确认及超时重传机制
    TCP 拥有流量控制及拥塞控制的机制
    
 4、TCP 的顺序问题，丢包问题，流量控制
 
    都是通过滑动窗口来解决的
    拥塞控制时通过拥塞窗口来解决的
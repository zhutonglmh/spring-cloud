package studyserverone.okhttp3;

import cn.hutool.core.collection.CollectionUtil;
import cn.hutool.core.date.DateUtil;
import com.alibaba.fastjson.JSONObject;
import okhttp3.*;

import java.util.Date;
import java.util.List;
import java.util.Map;
import java.util.concurrent.TimeUnit;

/**
 * @author zhutong
 * @date 2019/9/29 14:11
 */
public class Main2 {
    
    
    
    public static void main(String[] args) throws Exception{
        
        String sql = "SELECT count(*) AS total FROM scm_order_demand WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_order WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_direct WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_direct_send WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 912 AND org_type = 2 AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_order_back WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_dispatch WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 939 AND org_type = 2 AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_dispatch_dif WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_prepare_goods WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_depot_pick_goods WHERE create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 921 AND org_type = 2 AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 913 AND org_type IN (2, 3) AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 914 AND org_type = 2 AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT 0 AS total UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 922 AND org_type = 2 AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 915 AND org_type IN (2, 3) AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0 UNION ALL SELECT count(*) AS total FROM scm_stock_flow WHERE bill_type = 919 AND org_type = 2 AND create_time > 'startDate 00:00:00' AND create_time < 'endDate 00:00:00' AND tenant_id NOT IN ( '520829d8b47745d08b304c3dbe3fca9d', '5abf001796d190000d07a59a', '5c89e7c63601700001c461f3', '5d0735d4ecc50f0001c1f454', '5d07bc9decc50f0001c1f45b', '5d07c1827c59920001a7dc61', '5d08f50fecc50f0001c1f4e7', '5d2fea6aecc50f0001c202af', '5d3fe3d796d190000153b109', '5d4c396decc50f0001c20893', '7368e535f270443eb7f6b56005a81f30', 'b81c52b170bc4c1eb9fb559131cdef36', 'c5275c0472c44780bae3ddef9297459f', 'd7a33b1f879c4cc5830d24f8e054ef97' ) AND delete_flag = 0";
        Date date = DateUtil.parseDate("2019-09-22");
       JSONObject sqlAddr = JSONObject.parseObject("{\"sql\":\"explain select * from scm_stock_goods_detail where tenant_id = '5b308129360170000172afa6'  and store_id = \\\"6e6f11213dcb415b98713776bdc8bfba\\\" and (buss_date between \\\"2019-08-25\\\" and \\\"2019-09-25\\\")\",\"basename\":\"online_cloud_scm\",\"source\":\"online_scm_select\"}");
    
        for (int i = 0; i <7 ; i++) {
            String dateStr  = DateUtil.formatDate(date);
            Date nextDate =  DateUtil.offsetDay(date,1);
            String nextDateStr = DateUtil.formatDate(nextDate);
    
            String sql2 = sql.replace("startDate",dateStr).replace("endDate",nextDateStr);
            System.out.println(dateStr +"~"+nextDateStr);
    
            sqlAddr.put("sql",sql2);
            System.out.println(sql2);
            RequestBody body = RequestBody.create(MediaType.parse("application/json"), JSONObject.toJSONString(sqlAddr));
            Request requestOk = new Request.Builder()
                                        .url("http://47.98.58.111:18080/api/v2/query")
                                        .post(body)
                                        .header("Authorization", "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1Njk3NTI2OTcsIm5hbWUiOiLmnLHlkIwiLCJyb2xlIjoiZ3Vlc3QifQ.zl3PdDzyp-wqewDSo1f-q2S4UF4M7h3nQJO9oaXP8sk")
                                        .build();
            Response response;
            OkHttpClient client = new OkHttpClient.Builder()
                                          .connectTimeout(6000, TimeUnit.SECONDS)//设置连接超时时间
                                          .readTimeout(6000, TimeUnit.SECONDS)//设置读取超时时间
                                          .build();
            response = client.newCall(requestOk).execute();
            String jsonString = response.body().string();
            if (response.isSuccessful()) {
                JSONObject jsonObject = JSONObject.parseObject(jsonString);
                List<Map<String, Object>> maps = (List<Map<String, Object>>) jsonObject.get("data");
            
                for (Map<String, Object> s : maps) {
                    System.out.println(s.get("total"));
                }
            }
            System.out.println("---------------------------------------------");
            date = nextDate;
        }
    }
}
